# Electronics Retail Network API

Сервис для управления иерархической структурой торговой сети электроники. Реализован на Django REST Framework с использованием PostgreSQL. Проект полностью докеризирован и готов к развертыванию (Nginx + Gunicorn).

## Техническое задание и стек

Проект реализует API для сети, состоящей из:
- Заводов (уровень 0)
- Розничных сетей (уровень 1)
- Индивидуальных предпринимателей (уровень 2)

**Стек технологий:**
- **Python 3.10** + **Django 4.2**
- **Django REST Framework** (API)
- **PostgreSQL** (База данных)
- **Gunicorn** + **Nginx** (Сервер приложений и веб-сервер)
- **Docker** + **Docker Compose** (Контейнеризация)
- **drf-yasg** (Swagger документация)
- **Simple JWT** (Авторизация)


## Запуск проекта (Docker)

Это рекомендуемый способ запуска. Вам понадобятся установленные Docker и Docker Compose.

1. **Клонируйте репозиторий:**
   ```bash
   git clone github.com/gleafy/electronics-netshop
   cd electronics-netshop
   ```

2. **Создайте файл `.env`** (рекомендуется изменить стандартные значения):
   ```bash
   cp .env.example .env
   ```

3. **Запустите сборку и контейнеры:**
   ```bash
   docker compose up -d --build
   ```
   *При первом запуске автоматически применятся миграции и соберется статика.*

4. **Создайте суперпользователя (для доступа к админке):**
   ```bash
   docker compose exec web python manage.py createsuperuser
   ```

5. **Готово!**
   - **API документация (Swagger):** [http://localhost/](http://localhost/)
   - **Админ-панель:** [http://localhost/admin/](http://localhost/admin/)


## Локальная разработка (без Docker)

Если вы хотите запустить проект локально в виртуальном окружении:

1. Создайте и активируйте venv:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   # venv\Scripts\activate   # Windows
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Настройте БД в `.env`.

4. Примените миграции и запустите сервер:
   ```bash
   python manage.py migrate
   python manage.py runserver
   ```

## Работа с API

### Авторизация
Проект использует JWT-авторизацию. Доступ к методам (кроме просмотра документации) открыт только для активных сотрудников.

1. Получите токен по адресу `/api/token/` (POST запрос с `username` и `password`).
2. В Swagger нажмите кнопку **Authorize** и введите значение в формате:
   ```
   Bearer <ваш_access_token>
   ```

### Особенности реализации
- **Иерархия:** Уровень звена сети (Завод/Розница/ИП) вычисляется автоматически в зависимости от выбранного поставщика.
- **Валидация:** Запрещены циклические ссылки и иерархия глубже 2 уровня.
- **Задолженность:** Поле "Задолженность" недоступно для изменения через API (update), только через админ-панель (действие "Очистить задолженность").